# Generating a default-env.json file

Sometimes you want to run a CAP application locally for testing purposes. If that application requires a connection to a remote service on the Cloud Foundry (CF) runtime of SAP Cloud Platform, you can do this by making service binding details available locally to that application.

This is done using values in a specially named file `default-env.json`.

There are various ways to generate the contents needed for such a file, here's one.

The scenario here is where a CAP application running locally must connect to an instance of an SAP Enterprise Messaging service instance running in the CF runtime of an SAP Cloud Platform trial account. The instance name is `emdev`.

##Â Approach

The general idea is that service bindings can be generated by binding the service instance to an app that's also in that CF space, and then using the standard `cf env` command to request the environment variables for that app, which will include the service binding information. Specifically we're looking for the `VCAP_SERVICES` environment variable, but there's also the `VCAP_APPLICATION` environment variable that's useful to have too.

So the approach is to deploy a very simple temporary (throwaway) app, bind the service instance to it, request the environment variables, and then delete the app.

## Step by step

First, pick a temporary name - we'll use this throughout these steps. Let's pick `mytempapp` for example.

```sh
$ appname=mytempapp
```

First, make sure that there's no directory called `mytempapp`, and no existing app already deployed with that name:

```sh
$ rmdir $appname
$ cf d -f $appname
```

Now create a new temporary app directory and deploy the app based upon that:

```sh
$ mkdir $appname
$ cf push -c null --no-route --no-start $appname $appname
```

Next, bind the service instance to the app and then request the environment information

```sh
$ cf bind-instance $appname emdev
$ cf env $appname > default-env.txt
```

The output of `cf env` contains what we need, but also some extraneous information. So open the `default-env.txt` file up and edit it to leave just the JSON section containing the `VCAP_SERVICES` section, as shown here, i.e. remove everything except what's shown between the START and END cut lines.

```
Getting env variables for app temp in org 4dc50e9btrial / space dev as qmacro+workflowcodejam@gmail.com...
OK

System-Provided:
---START----8<------------------------------------------------------------
{
 "VCAP_SERVICES": {
  "enterprise-messaging": [
   {
    "binding_name": null,
    "credentials": {
     "management": [
      {
       "oa2": {
        "clientid": "sb-clone-xbem-service-broker-aec3bfac91f84d61841ef28efb7fa235-clone!b68527|xbem-service-broker-!b2436",
        ...
      }
     ]
    }
    "label": "enterprise-messaging",
    "name": "emdev",
    "plan": "dev",
    "provider": null,
    "syslog_drain_url": null,
    "tags": [
     "enterprise-messaging"
    ],
    "volume_mounts": []
   }
  ]
 }
}
---END------8<------------------------------------------------------------
{
 "VCAP_APPLICATION": {
  "application_id": "d279e412-be5d-48fc-bf40-8d887c77f263",
  "application_name": "temp",
  ...
 }
}

No user-defined env variables have been set

Running Environment Variable Groups:
CREDHUB_API: https://credhub.service.cf.internal

No staging env variables have been set

```

Finally, now you have pure JSON in the file, rename it to `default-env.json` and you're done!
